<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% if lang=='nl' %}Keverwaarnemingen{% else %}Beetle Observations{% endif %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen">
  <header class="flex justify-between items-center p-4 bg-white shadow">
    <h1 class="text-xl font-bold">
      {% if lang=='nl' %}Keverwaarnemingen{% else %}Beetle Observations{% endif %}
    </h1>
    <div class="flex items-center space-x-4">
      <form method="get">
        <select name="lang" onchange="this.form.submit()" class="border p-1">
          <option value="nl" {% if lang=='nl' %}selected{% endif %}>NL</option>
          <option value="en" {% if lang=='en' %}selected{% endif %}>EN</option>
        </select>
      </form>
    </div>
  </header>

  <main class="p-6 max-w-3xl mx-auto">
    <form method="post" class="mb-6 space-y-4">
      <input type="hidden" name="lang" value="{{ lang }}" />
      <label>{% if lang=='nl' %}Kies datum:{% else %}Select date:{% endif %}</label>
      <input type="date" name="date" value="{{ date or '' }}" class="w-full p-2 border rounded" />
      <button type="submit" class="w-full bg-green-600 text-white p-2 rounded">
        {% if lang=='nl' %}Toon waarnemingen{% else %}Show Observations{% endif %}
      </button>
    </form>

    {% if observations %}
      <ul class="space-y-4 mb-10">
        {% for obs in observations %}
          <li class="border rounded p-4 bg-white">
            <p><strong>{% if lang=='nl' %}Aantal{% else %}Count{% endif %}:</strong> {{ obs.count }}</p>
            <p><strong>{% if lang=='nl' %}Naam{% else %}Common Name{% endif %}:</strong> {{ obs.common_name }}</p>
            <p><strong>{% if lang=='nl' %}Wetenschappelijke naam{% else %}Latin Name{% endif %}:</strong> {{ obs.latin_name }}</p>
            <p><strong>{% if lang=='nl' %}Beschrijving{% else %}Description{% endif %}:</strong> {{ obs.description or '-' }}</p>
            <p><strong>{% if lang=='nl' %}Plaats{% else %}Location{% endif %}:</strong> {{ obs.place }}</p>
            <p><strong>{% if lang=='nl' %}Waarnemer{% else %}Observer{% endif %}:</strong> {{ obs.observer }}</p>
            <p><strong>{% if lang=='nl' %}Datum{% else %}Date{% endif %}:</strong> {{ obs.obs_date }}</p>

            {% if obs.photo_link %}
              <p class="mt-2">
                <a href="{{ obs.photo_link }}" target="_blank" rel="noopener">
                  <img src="{{ obs.photo_link }}"
                       class="w-32 rounded cursor-pointer"
                       alt="Foto waarneming" />
                </a>
              </p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <div id="map" class="h-[500px] w-full border rounded overflow-hidden"></div>
  </main>

  <script>
    const map = L.map('map').setView([50.5,4.1],9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution:'&copy; OSM contributors'
    }).addTo(map);
    const heatCoords = {{ heat_coords|tojson }};
    if (heatCoords.length) {
      L.heatLayer(heatCoords,{radius:20,blur:15}).addTo(map);
      heatCoords.forEach(([lat,lon])=>{
        L.circleMarker([lat,lon],{radius:4,color:'red'}).addTo(map);
      });
    }
  </script>
</body>
</html>
