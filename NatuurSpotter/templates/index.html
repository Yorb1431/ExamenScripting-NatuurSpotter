<!DOCTYPE html>
<html lang="{{ lang }}" class="transition-colors duration-300">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% if lang=='nl' %}Keverwaarnemingen{% else %}Beetle Observations{% endif %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">

  <!-- HEADER -->
  <header class="flex justify-between items-center p-4 bg-white dark:bg-gray-800 shadow">
    <h1 class="text-xl font-bold">
      {% if lang=='nl' %}Keverwaarnemingen{% else %}Beetle Observations{% endif %}
    </h1>
    <div class="flex items-center space-x-4">
      <form method="get">
        <select name="lang" onchange="this.form.submit()" class="bg-gray-100 dark:bg-gray-700 rounded p-1">
          <option value="nl" {% if lang=='nl' %}selected{% endif %}>NL</option>
          <option value="en" {% if lang=='en' %}selected{% endif %}>EN</option>
        </select>
      </form>
      <button id="theme-toggle" class="p-1 rounded bg-gray-200 dark:bg-gray-700">
        <span id="theme-icon">üåô</span>
      </button>
    </div>
  </header>

  <!-- MAIN -->
  <main class="p-6 max-w-3xl mx-auto">
    <form method="post" class="mb-6 space-y-4">
      <input type="hidden" name="lang" value="{{ lang }}" />
      <label class="block font-semibold">{% if lang=='nl' %}Kies datum:{% else %}Select date:{% endif %}</label>
      <input type="date" name="date" value="{{ date or '' }}" class="w-full p-2 rounded bg-white dark:bg-gray-800 border" />
      <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white p-2 rounded">
        {% if lang=='nl' %}Toon waarnemingen{% else %}Show Observations{% endif %}
      </button>
    </form>

    {% if observations %}
      <ul class="space-y-4 mb-10">
        {% for obs in observations %}
          <li class="border rounded p-4 bg-white dark:bg-gray-800">
            <p><strong>{% if lang=='nl' %}Aantal{% else %}Count{% endif %}:</strong> {{ obs.count }}</p>
            <p><strong>{% if lang=='nl' %}Naam{% else %}Common Name{% endif %}:</strong> {{ obs.common_name }}</p>
            <p><strong>{% if lang=='nl' %}Wetenschappelijke naam{% else %}Latin Name{% endif %}:</strong> {{ obs.latin_name }}</p>
            <p><strong>{% if lang=='nl' %}Beschrijving{% else %}Description{% endif %}:</strong> {{ obs.description }}</p>
            <p><strong>{% if lang=='nl' %}Plaats{% else %}Location{% endif %}:</strong> {{ obs.place }}</p>
            <p><strong>{% if lang=='nl' %}Waarnemer{% else %}Observer{% endif %}:</strong> {{ obs.observer }}</p>
            <p><strong>{% if lang=='nl' %}Datum{% else %}Date{% endif %}:</strong> {{ obs.obs_date }}</p>

            {% if obs.photo_link %}
              <div class="mt-2">
                <a href="{{ obs.photo_link }}" target="_blank" rel="noopener">
                  <img src="{{ obs.photo_link }}"
                       alt="Foto waarneming"
                       class="w-32 h-auto rounded shadow cursor-pointer hover:opacity-80 transition-opacity"/>
                </a>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <div id="map" class="h-[500px] w-full border rounded overflow-hidden"></div>
  </main>

  <!-- Dark mode script (ongewijzigd) -->
  <script>
    const html = document.documentElement;
    const btn = document.getElementById("theme-toggle");
    const icon = document.getElementById("theme-icon");
    if (localStorage.getItem("theme")==="dark") {
      html.classList.add("dark");
      icon.textContent="‚òÄÔ∏è";
    }
    btn.addEventListener("click",()=>{
      html.classList.toggle("dark");
      const isDark=html.classList.contains("dark");
      icon.textContent=isDark?"‚òÄÔ∏è":"üåô";
      localStorage.setItem("theme", isDark?"dark":"light");
    });
  </script>

  <!-- Leaflet + Heatmap -->
  <script>
    const map = L.map('map').setView([50.5,4.1],9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution:'&copy; OpenStreetMap contributors'
    }).addTo(map);

    const heatCoords = {{ heat_coords|tojson }};
    if (heatCoords.length>0) {
      L.heatLayer(heatCoords,{radius:20,blur:15}).addTo(map);
      heatCoords.forEach(([lat,lon])=>{
        L.circleMarker([lat,lon],{radius:4,color:'red'}).addTo(map);
      });
    }
  </script>
</body>
</html>
